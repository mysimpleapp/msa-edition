<style>
	msa-box, msa-box-partial {
		display: block;
		position: absolute;
	}
</style>
<template id="msa-box-partial">
</template>
<script>
(function() {
	// create msa-box element
	App.registerElement("msa-box", {oncreate: function(){
		this.isBox = true
	}})
	// retrieve box content from server
	BoxCache = {}
	var getBoxContent = function(box) {
		var src = box.getAttribute("src")
		if(!src) box.content.innerHTML = ""
		else {
			var cache = BoxCache[src]
			if(cache===undefined) {
				BoxCache[src] = [box]
				App.get(src, null, function(data){
					var boxes = BoxCache[src]
					BoxCache[src] = data
					for(var b=0, len=boxes.length; b<len; ++b)
						loadBoxContent(boxes[b], data)
				})
			} else if(cache.length!==undefined) cache.push(box)
			else loadBoxContent(box, cache)
		}
	}
	var loadBoxContent = function(box, data) {
		var div = document.createElement("div")
		div.innerHTML = data.head
		for(var d=0, childs=div.childNodes, len=childs.length; d<len; ++d)
			document.head.appendChild(childs[d])
		box.content.innerHTML = data.body
	}
	// create msa-box-partial element
	App.registerElement("msa-box-partial", {shadow:"#msa-box-partial",
		oncreate: function(){
			this.isBox = true
			this.isBoxPartial = true
			this.editing = false
			Bind(this.shadowRoot, this)
			this.content = this.shadowRoot
			getBoxContent(this)
		},
		onchange: function(attr, oldVal, newVal) {
			if(attr=="src") getBoxContent(this)
		}
	});
})();
</script>
